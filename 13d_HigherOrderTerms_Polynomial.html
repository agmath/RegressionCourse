<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.43">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2024-07-31">

<title>Using Higher-Order Terms: Curvi-Linear (Polynomial) Terms</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="13d_HigherOrderTerms_Polynomial_files/libs/clipboard/clipboard.min.js"></script>
<script src="13d_HigherOrderTerms_Polynomial_files/libs/quarto-html/quarto.js"></script>
<script src="13d_HigherOrderTerms_Polynomial_files/libs/quarto-html/popper.min.js"></script>
<script src="13d_HigherOrderTerms_Polynomial_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="13d_HigherOrderTerms_Polynomial_files/libs/quarto-html/anchor.min.js"></script>
<link href="13d_HigherOrderTerms_Polynomial_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="13d_HigherOrderTerms_Polynomial_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="13d_HigherOrderTerms_Polynomial_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="13d_HigherOrderTerms_Polynomial_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="13d_HigherOrderTerms_Polynomial_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="13d_HigherOrderTerms_Polynomial_files/libs/kePrint-0.0.1/kePrint.js"></script>
<link href="13d_HigherOrderTerms_Polynomial_files/libs/lightable-0.0.1/lightable.css" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#where-we-stand" id="toc-where-we-stand" class="nav-link active" data-scroll-target="#where-we-stand">Where We Stand</a></li>
  <li><a href="#objectives" id="toc-objectives" class="nav-link" data-scroll-target="#objectives">Objectives</a></li>
  <li><a href="#a-new-data-set-boston-housing" id="toc-a-new-data-set-boston-housing" class="nav-link" data-scroll-target="#a-new-data-set-boston-housing">A New Data Set: Boston Housing</a></li>
  <li><a href="#motivating-interaction-and-higher-order-terms" id="toc-motivating-interaction-and-higher-order-terms" class="nav-link" data-scroll-target="#motivating-interaction-and-higher-order-terms">Motivating Interaction and Higher-Order Terms</a></li>
  <li><a href="#new-terminology" id="toc-new-terminology" class="nav-link" data-scroll-target="#new-terminology">New Terminology</a></li>
  <li><a href="#starting-with-a-main-effects-model" id="toc-starting-with-a-main-effects-model" class="nav-link" data-scroll-target="#starting-with-a-main-effects-model">Starting with a Main-Effects Model</a></li>
  <li><a href="#building-a-model-including-curvature-step_poly" id="toc-building-a-model-including-curvature-step_poly" class="nav-link" data-scroll-target="#building-a-model-including-curvature-step_poly">Building a Model Including Curvature (<code>step_poly()</code>)</a>
  <ul class="collapse">
  <li><a href="#interpreting-a-model-with-curvature" id="toc-interpreting-a-model-with-curvature" class="nav-link" data-scroll-target="#interpreting-a-model-with-curvature">Interpreting a Model with Curvature</a></li>
  <li><a href="#assessing-model-performance" id="toc-assessing-model-performance" class="nav-link" data-scroll-target="#assessing-model-performance">Assessing Model Performance</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Using Higher-Order Terms: Curvi-Linear (Polynomial) Terms</h1>
</div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">July 31, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="where-we-stand" class="level2">
<h2 class="anchored" data-anchor-id="where-we-stand">Where We Stand</h2>
<p>We’ve come a long way over the past few weeks. We’ve followed the trajectory below.</p>
<ul>
<li><p><strong>Simple Linear Regression Models:</strong> <span class="math inline">\(\mathbb{E}\left[y\right] = \beta_0 + \beta_1 \cdot x_1\)</span></p>
<ul>
<li><em>General Assumption</em>: We can predict the response, <span class="math inline">\(y\)</span>, using knowledge of another variable, <span class="math inline">\(x_1\)</span>. The relationship between <span class="math inline">\(y\)</span> and <span class="math inline">\(x_1\)</span> is a straight line relationship, with random noise (irreducible error).</li>
<li><em>Model Form</em>: A simple linear regression model is a straight line.</li>
</ul></li>
<li><p><strong>Multiple Linear Regression Models:</strong> <span class="math inline">\(\mathbb{E}\left[y\right] = \beta_0 + \beta_1 x_1 + \beta_2 x_2 + \cdots + \beta_k x_k\)</span></p>
<ul>
<li><p><em>General Assumption</em>: We can predict the response, <span class="math inline">\(y\)</span>, using knowledge of other variables, <span class="math inline">\(x_1,~x_2,~\cdots,~x_k\)</span>.</p>
<ul>
<li>For any of the <span class="math inline">\(x_i\)</span> which are numerical, the association between <span class="math inline">\(y\)</span> and <span class="math inline">\(x_i\)</span> is a straight line relationship, with slope (<span class="math inline">\(\beta_i\)</span>) independent of all other predictors <span class="math inline">\(x_j\)</span>.</li>
<li>For any of the <span class="math inline">\(x_i\)</span> which are dummy variables corresponding to a categorical predictor, the impact of including <span class="math inline">\(x_i\)</span> in the model is a vertical shift. That is, a change in <em>intercept</em> specific to that particular level of the categorical variable.</li>
<li>All other fluctuation in <span class="math inline">\(y\)</span> is random noise (irreducible error).</li>
</ul></li>
<li><p><em>Model Form</em>: A multiple linear regression model with no categorical predictors is a <em>flat</em> hyperplane, while a multiple linear regression model with categorical predictors is a set of parallel, flat hyperplanes.</p></li>
</ul></li>
</ul>
<p>We can see these model forms below. For ease of visualization, we’ll use a simple linear regression model to predict penguin <code>body_mass_g</code> using <code>bill_length_mm</code> on the left. In the plot on the right, we’ll extend that model by introducing dummy variables corresponding to the <code>species</code> variable. Note that a hyperplane in two dimensions (<code>bill_length_mm</code> and <code>body_mass_g</code>) is a straight line.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="13d_HigherOrderTerms_Polynomial_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We can see that our models in both cases are straight lines, and that the models are parallel lines in the case where we included the <code>species</code> variable. We’ll move beyond these restrictions in this notebook and the next one too.</p>
<ul>
<li>In this notebook, we’ll discuss methods for adding curvature to our models. This is sometimes called curvi-linear regression.</li>
<li>In our next notebook, we’ll discuss methods for allowing interaction between terms. Among other things, interaction terms will allow for non-parallel hyperplanes (different rates of change / slopes for different categories).</li>
</ul>
</section>
<section id="objectives" class="level2">
<h2 class="anchored" data-anchor-id="objectives">Objectives</h2>
<p>In previous notebooks we learned how to build, assess, and interpret simple and multiple linear regression models, including those with categorical predictors. Those models all made the following assumptions:</p>
<ul>
<li>The association between the response and any individual predictor is linear.</li>
<li>All predictor variables act independently in influencing/predicting the response.</li>
<li>The association between any numerical predictor and the response (the <em>slope</em> of the model) is the same, regardless of the class/category</li>
</ul>
<p>What happens if these assumptions aren’t reasonable (or we want to explore whether relaxing these assumptions improves fit)? In this notebook, we’ll see how to update our models to allow for curved relationships and predictors which do not act independently to influence our response variable. After reviewing this notebook, you should be able to:</p>
<ul>
<li><p>Use exploratory data analysis to identify visual evidence for curved relationships and interaction between predictors.</p></li>
<li><p>Use <code>step_*()</code> functions to augment a <code>recipe()</code>, updating how predictor variables are utilized in a regression model.</p>
<ul>
<li>These <code>step_*()</code> functions are feature engineering steps, which transform our underlying data set.</li>
</ul></li>
<li><p>Use <code>step_poly()</code> to allow for polynomial terms in a model – that is, terms whose corresponding predictor variable is raised to a positive integer power.</p></li>
<li><p>Fit, assess, reduce, interpret, and utilize models including polynomial terms.</p></li>
</ul>
<hr>
</section>
<section id="a-new-data-set-boston-housing" class="level2">
<h2 class="anchored" data-anchor-id="a-new-data-set-boston-housing">A New Data Set: Boston Housing</h2>
<p>There’s not much visual evidence to suggest curved relationships between the physiological features and penguin body mass in the <code>palmerpenguins</code> data set. Because of this, we’ll temporarily shift to a new data set on median property values in Boston from the 1970’s.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>boston <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"https://raw.githubusercontent.com/selva86/datasets/master/BostonHousing.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 506 Columns: 14
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
dbl (14): crim, zn, indus, chas, nox, rm, age, dis, rad, tax, ptratio, b, ls...

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>boston <span class="sc">%&gt;%</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>() <span class="sc">%&gt;%</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>() <span class="sc">%&gt;%</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-hover table-striped caption-top table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">crim</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">zn</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">indus</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">chas</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">nox</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">rm</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">age</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">dis</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">rad</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">tax</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">ptratio</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">b</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">lstat</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">medv</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0.00632</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">2.31</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.538</td>
<td style="text-align: right;">6.575</td>
<td style="text-align: right;">65.2</td>
<td style="text-align: right;">4.0900</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">296</td>
<td style="text-align: right;">15.3</td>
<td style="text-align: right;">396.90</td>
<td style="text-align: right;">4.98</td>
<td style="text-align: right;">24.0</td>
</tr>
<tr class="even">
<td style="text-align: right;">0.02731</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">7.07</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.469</td>
<td style="text-align: right;">6.421</td>
<td style="text-align: right;">78.9</td>
<td style="text-align: right;">4.9671</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">242</td>
<td style="text-align: right;">17.8</td>
<td style="text-align: right;">396.90</td>
<td style="text-align: right;">9.14</td>
<td style="text-align: right;">21.6</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0.02729</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">7.07</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.469</td>
<td style="text-align: right;">7.185</td>
<td style="text-align: right;">61.1</td>
<td style="text-align: right;">4.9671</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">242</td>
<td style="text-align: right;">17.8</td>
<td style="text-align: right;">392.83</td>
<td style="text-align: right;">4.03</td>
<td style="text-align: right;">34.7</td>
</tr>
<tr class="even">
<td style="text-align: right;">0.03237</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2.18</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.458</td>
<td style="text-align: right;">6.998</td>
<td style="text-align: right;">45.8</td>
<td style="text-align: right;">6.0622</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">222</td>
<td style="text-align: right;">18.7</td>
<td style="text-align: right;">394.63</td>
<td style="text-align: right;">2.94</td>
<td style="text-align: right;">33.4</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0.06905</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2.18</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.458</td>
<td style="text-align: right;">7.147</td>
<td style="text-align: right;">54.2</td>
<td style="text-align: right;">6.0622</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">222</td>
<td style="text-align: right;">18.7</td>
<td style="text-align: right;">396.90</td>
<td style="text-align: right;">5.33</td>
<td style="text-align: right;">36.2</td>
</tr>
<tr class="even">
<td style="text-align: right;">0.02985</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2.18</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.458</td>
<td style="text-align: right;">6.430</td>
<td style="text-align: right;">58.7</td>
<td style="text-align: right;">6.0622</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">222</td>
<td style="text-align: right;">18.7</td>
<td style="text-align: right;">394.12</td>
<td style="text-align: right;">5.21</td>
<td style="text-align: right;">28.7</td>
</tr>
</tbody>
</table>


</div>
</div>
<p>This Boston housing dataset is quite famous (<a href="https://fairlearn.org/main/user_guide/datasets/boston_housing_data.html">and problematic</a>), and includes features on each neighborhood and the corresponding median home value in that neighborhood. You can see a data dictionary <a href="https://www.kaggle.com/code/prasadperera/the-boston-housing-dataset">here</a>. The data set has many interesting features and even allows us some ability to explore structural racism in property valuation in 1970s Boston.</p>
<p>We’ll assume that <code>medv</code>, the median home value in thousands of dollars, is our response variable and we’ll focus on the <code>age</code>, <code>lstat</code>, and <code>chas</code> predictors.</p>
</section>
<section id="motivating-interaction-and-higher-order-terms" class="level2">
<h2 class="anchored" data-anchor-id="motivating-interaction-and-higher-order-terms">Motivating Interaction and Higher-Order Terms</h2>
<p>Let’s take a look at the relationships between some of the available predictors in the <code>boston</code> data set and the median home values (<code>medv</code>). As usual, we’ll split off the <em>training</em> and <em>test</em> sets so that the <em>test</em> data remains hidden from ourselves and the model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>boston_split <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(boston)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>boston_train <span class="ot">&lt;-</span> <span class="fu">training</span>(boston_split)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>boston_test <span class="ot">&lt;-</span> <span class="fu">testing</span>(boston_split)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>boston_test <span class="sc">%&gt;%</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>() <span class="sc">%&gt;%</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>() <span class="sc">%&gt;%</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-hover table-striped caption-top table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">crim</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">zn</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">indus</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">chas</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">nox</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">rm</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">age</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">dis</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">rad</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">tax</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">ptratio</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">b</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">lstat</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">medv</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0.00632</td>
<td style="text-align: right;">18.0</td>
<td style="text-align: right;">2.31</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.538</td>
<td style="text-align: right;">6.575</td>
<td style="text-align: right;">65.2</td>
<td style="text-align: right;">4.0900</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">296</td>
<td style="text-align: right;">15.3</td>
<td style="text-align: right;">396.90</td>
<td style="text-align: right;">4.98</td>
<td style="text-align: right;">24.0</td>
</tr>
<tr class="even">
<td style="text-align: right;">0.02729</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: right;">7.07</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.469</td>
<td style="text-align: right;">7.185</td>
<td style="text-align: right;">61.1</td>
<td style="text-align: right;">4.9671</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">242</td>
<td style="text-align: right;">17.8</td>
<td style="text-align: right;">392.83</td>
<td style="text-align: right;">4.03</td>
<td style="text-align: right;">34.7</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0.06905</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: right;">2.18</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.458</td>
<td style="text-align: right;">7.147</td>
<td style="text-align: right;">54.2</td>
<td style="text-align: right;">6.0622</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">222</td>
<td style="text-align: right;">18.7</td>
<td style="text-align: right;">396.90</td>
<td style="text-align: right;">5.33</td>
<td style="text-align: right;">36.2</td>
</tr>
<tr class="even">
<td style="text-align: right;">0.21124</td>
<td style="text-align: right;">12.5</td>
<td style="text-align: right;">7.87</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.524</td>
<td style="text-align: right;">5.631</td>
<td style="text-align: right;">100.0</td>
<td style="text-align: right;">6.0821</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">311</td>
<td style="text-align: right;">15.2</td>
<td style="text-align: right;">386.63</td>
<td style="text-align: right;">29.93</td>
<td style="text-align: right;">16.5</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0.09378</td>
<td style="text-align: right;">12.5</td>
<td style="text-align: right;">7.87</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.524</td>
<td style="text-align: right;">5.889</td>
<td style="text-align: right;">39.0</td>
<td style="text-align: right;">5.4509</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">311</td>
<td style="text-align: right;">15.2</td>
<td style="text-align: right;">390.50</td>
<td style="text-align: right;">15.71</td>
<td style="text-align: right;">21.7</td>
</tr>
<tr class="even">
<td style="text-align: right;">0.85204</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: right;">8.14</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.538</td>
<td style="text-align: right;">5.965</td>
<td style="text-align: right;">89.2</td>
<td style="text-align: right;">4.0123</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">307</td>
<td style="text-align: right;">21.0</td>
<td style="text-align: right;">392.53</td>
<td style="text-align: right;">13.83</td>
<td style="text-align: right;">19.6</td>
</tr>
</tbody>
</table>


</div>
</div>
<p>Now let’s do some visualization.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> boston_train <span class="sc">%&gt;%</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hex</span>(<span class="fu">aes</span>(<span class="at">x =</span> lstat, <span class="at">y =</span> medv)) <span class="sc">+</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Proportion Residents with Low Socioeconomic Status"</span>,</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Median Home Values (000s)"</span>)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> boston_train <span class="sc">%&gt;%</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> medv),</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span> </span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Proportion of Homes Built Before 1940"</span>,</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Median Home Values (000s)"</span>)</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> boston_train <span class="sc">%&gt;%</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">chas =</span> <span class="fu">ifelse</span>(chas <span class="sc">==</span> <span class="dv">1</span>, <span class="st">"on"</span>, <span class="st">"off"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> chas, <span class="at">y =</span> medv)) <span class="sc">+</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"On the Charles River"</span>,</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Median Home Values (000s)"</span>) <span class="sc">+</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>()</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>(p1 <span class="sc">+</span> p2) <span class="sc">/</span> p3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="13d_HigherOrderTerms_Polynomial_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>From the plots above, we see that the association between the proportion of residents having low socioeconomic status (<code>lstat</code>) and the median home values (<code>medv</code>) have a nonlinear association. Additionally, it may be reasonable to suspect that the “slope” of the model with respect to <code>age</code> (the proportion of homes built prior to 1940) is different for neighborhoods on the Charles River versus those which are away from the river. We’ll explore all of these things, and more, in the coming sections of this notebook.</p>
</section>
<section id="new-terminology" class="level2">
<h2 class="anchored" data-anchor-id="new-terminology">New Terminology</h2>
<p>Before we start building models, its worth developing some helpful terminology. Consider the model below:</p>
<p><span class="math inline">\(\begin{align}\mathbb{E}\left[\text{medv}\right] = &amp;\beta_0 + \beta_1\cdot\left(\text{age}\right) + \beta_2\cdot\left(\text{lstat}\right) + \beta_3\cdot\left(\text{chas}\right) + \beta_4\cdot\left(\text{age}^2\right) +\\ &amp;\beta_5\cdot\left(\text{chas}\cdot\text{age}\right) + \beta_6\cdot\left(\text{chas}\cdot\text{age}^2\right) + \beta_7\cdot\left(\text{chas}\cdot\text{lstat}\right) + \beta_8\cdot\left(\text{age}\cdot\text{lstat}\right) + \beta_9\cdot\left(\text{age}^2\cdot \text{lstat}\right)\end{align}\)</span></p>
<ul>
<li><p>The <strong>order</strong> of a model is the highest degree of any term in the model. Only numeric predictors contribute to the degree of a term.</p>
<ul>
<li>The order of the proposed model above is <em>third</em> order, because of the <span class="math inline">\(\text{age}^2\cdot\text{lstat}\)</span> term.</li>
</ul></li>
<li><p>Models including interaction terms include <strong>main effects</strong> and <strong>mixed effects</strong> terms. The main effects terms contain a single predictor, while the mixed effects terms contain multiple predictors.</p></li>
</ul>
<p><span class="math inline">\(\begin{align}\mathbb{E}\left[\text{medv}\right] = &amp;\overbrace{\beta_0 + \beta_1\cdot\left(\text{age}\right) + \beta_2\cdot\left(\text{lstat}\right) + \beta_3\cdot\left(\text{chas}\right) + \beta_4\cdot\left(\text{age}^2\right)}^{\text{Main Effects}} +\\ &amp;\underbrace{\beta_5\cdot\left(\text{chas}\cdot\text{age}\right) + \beta_6\cdot\left(\text{chas}\cdot\text{age}^2\right) + \beta_7\cdot\left(\text{chas}\cdot\text{lstat}\right) + \beta_8\cdot\left(\text{age}\cdot\text{lstat}\right) + \beta_9\cdot\left(\text{age}^2\cdot \text{lstat}\right)}_{\text{Mixed Effects}}\end{align}\)</span></p>
<p>These <em>mixed effects</em> are interaction terms in our model, so we’ll wait until the next notebook to work with them.</p>
</section>
<section id="starting-with-a-main-effects-model" class="level2">
<h2 class="anchored" data-anchor-id="starting-with-a-main-effects-model">Starting with a Main-Effects Model</h2>
<p>Let’s start out with a basic model which uses <code>age</code>, <code>lstat</code>, and <code>chas</code> as straight-line predictors of median home values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>main_reg_spec <span class="ot">&lt;-</span> <span class="fu">linear_reg</span>() <span class="sc">%&gt;%</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"lm"</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>main_reg_rec <span class="ot">&lt;-</span> <span class="fu">recipe</span>(medv <span class="sc">~</span> age <span class="sc">+</span> lstat <span class="sc">+</span> chas, <span class="at">data =</span> boston_train)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>main_reg_wf <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(main_reg_spec) <span class="sc">%&gt;%</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(main_reg_rec)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>main_reg_fit <span class="ot">&lt;-</span> main_reg_wf <span class="sc">%&gt;%</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(boston_train)</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>main_reg_fit <span class="sc">%&gt;%</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">extract_fit_engine</span>() <span class="sc">%&gt;%</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>() <span class="sc">%&gt;%</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>() <span class="sc">%&gt;%</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-hover table-striped caption-top table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">term</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">estimate</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">std.error</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">statistic</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">32.7516586</td>
<td style="text-align: right;">0.8274053</td>
<td style="text-align: right;">39.583573</td>
<td style="text-align: right;">0.0000000</td>
</tr>
<tr class="even">
<td style="text-align: left;">age</td>
<td style="text-align: right;">0.0334359</td>
<td style="text-align: right;">0.0141179</td>
<td style="text-align: right;">2.368330</td>
<td style="text-align: right;">0.0183749</td>
</tr>
<tr class="odd">
<td style="text-align: left;">lstat</td>
<td style="text-align: right;">-1.0266175</td>
<td style="text-align: right;">0.0552625</td>
<td style="text-align: right;">-18.577111</td>
<td style="text-align: right;">0.0000000</td>
</tr>
<tr class="even">
<td style="text-align: left;">chas</td>
<td style="text-align: right;">4.7064996</td>
<td style="text-align: right;">1.2068696</td>
<td style="text-align: right;">3.899758</td>
<td style="text-align: right;">0.0001141</td>
</tr>
</tbody>
</table>


</div>
</div>
<p>Let’s compute our performance metrics for our main effects model so that we have a benchmark to try improving from.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>my_metrics <span class="ot">&lt;-</span> <span class="fu">metric_set</span>(rsq, rmse)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>(main_reg_fit <span class="sc">%&gt;%</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">augment</span>(boston_train) <span class="sc">%&gt;%</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">my_metrics</span>(medv, .pred) <span class="sc">%&gt;%</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">type =</span> <span class="st">"train"</span>)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    main_reg_fit <span class="sc">%&gt;%</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">augment</span>(boston_test) <span class="sc">%&gt;%</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">my_metrics</span>(medv, .pred) <span class="sc">%&gt;%</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">type =</span> <span class="st">"test"</span>)</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> .metric,</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>              <span class="at">names_from =</span> type,</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>              <span class="at">values_from =</span> .estimate) <span class="sc">%&gt;%</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>() <span class="sc">%&gt;%</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-hover table-striped caption-top table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">.metric</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">train</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">test</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">rsq</td>
<td style="text-align: right;">0.5822417</td>
<td style="text-align: right;">0.5235821</td>
</tr>
<tr class="even">
<td style="text-align: left;">rmse</td>
<td style="text-align: right;">5.9161187</td>
<td style="text-align: right;">6.4395620</td>
</tr>
</tbody>
</table>


</div>
</div>
<p>Okay, now that we’ve got those benchmark metrics, let’s see if we can improve on them by using higher-order terms.</p>
</section>
<section id="building-a-model-including-curvature-step_poly" class="level2">
<h2 class="anchored" data-anchor-id="building-a-model-including-curvature-step_poly">Building a Model Including Curvature (<code>step_poly()</code>)</h2>
<p>In order to build a model including curvature, we’ll need to include some <em>polynomial</em> terms. These are simply terms which include a predictor raised to an integer power greater than <span class="math inline">\(1\)</span>. We can do this by adding a <em>feature engineering</em> step to our <code>recipe()</code>, just like we did with <code>step_dummy()</code>. In order to add these higher-order terms that introduce curvature, we’ll use <code>step_poly()</code>. Let’s see it in action! We’ll include second-order terms associated with <code>age</code> and <code>lstat</code>, but not for the <code>chas</code> variable. This is because <code>chas</code> is a dummy variable, which can only take the values <span class="math inline">\(0\)</span> or <span class="math inline">\(1\)</span> – what happens when you square these values? Including polynomial terms with dummy variables doesn’t actually do anything!</p>
<p>Before we build our model, there are just a few comments about <code>step_poly()</code> that we should highlight.</p>
<ul>
<li><p>If you’d like to build polynomial terms associated with multiple variables, you can do this all at once by including each of the variables as the first few arguments to <code>step_poly()</code>, separating the variables by commas.</p></li>
<li><p>Set the <code>degree</code> of the polynomial terms (the amount of <em>wiggling</em> you’d like to allow) with the <code>degree</code> argument.</p>
<ul>
<li>The default degree for <code>step_poly()</code> is degree <span class="math inline">\(2\)</span>, allowing a single bend in the association between your predictor(s) and the response. You can override this default by setting <code>degree = 6</code>, for example. This would allow up to five bends in the association.</li>
</ul></li>
<li><p>Maintain your ability to interpret the relationship between predictor and response by setting <code>options = list(raw = TRUE)</code></p>
<ul>
<li>There is some <em>linear algebra</em> that can be done to try and reduce the correlation between our polynomial terms and their corresponding lower-order terms. You can think of this as squeezing all of the predictive juice out of the predictor. The <code>step_poly()</code> function does this by default, but results in a model which is more difficult to interpret. I recommend overriding this any time you intend to interpret your models. You can do this by setting <code>options = list(raw = TRUE)</code> within <code>step_poly()</code>.</li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>poly_reg_spec <span class="ot">&lt;-</span> <span class="fu">linear_reg</span>() <span class="sc">%&gt;%</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"lm"</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>poly_reg_rec <span class="ot">&lt;-</span> <span class="fu">recipe</span>(medv <span class="sc">~</span> age <span class="sc">+</span> lstat <span class="sc">+</span> chas, <span class="at">data =</span> boston_train) <span class="sc">%&gt;%</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_poly</span>(age, <span class="at">degree =</span> <span class="dv">2</span>, <span class="at">options =</span> <span class="fu">list</span>( <span class="at">raw =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_poly</span>(lstat, <span class="at">degree =</span> <span class="dv">2</span>, <span class="at">options =</span> <span class="fu">list</span>(<span class="at">raw =</span> <span class="cn">TRUE</span>))</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>poly_reg_wf <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(poly_reg_spec) <span class="sc">%&gt;%</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(poly_reg_rec)</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>poly_reg_fit <span class="ot">&lt;-</span> poly_reg_wf <span class="sc">%&gt;%</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(boston_train)</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>poly_reg_fit <span class="sc">%&gt;%</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glance</span>() <span class="sc">%&gt;%</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>() <span class="sc">%&gt;%</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-hover table-striped caption-top table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">r.squared</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">adj.r.squared</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">sigma</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">statistic</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">p.value</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">df</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">logLik</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">AIC</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">BIC</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">deviance</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">df.residual</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">nobs</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0.7016358</td>
<td style="text-align: right;">0.6976363</td>
<td style="text-align: right;">5.039795</td>
<td style="text-align: right;">175.43</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">-1147.735</td>
<td style="text-align: right;">2309.47</td>
<td style="text-align: right;">2337.033</td>
<td style="text-align: right;">9474.027</td>
<td style="text-align: right;">373</td>
<td style="text-align: right;">379</td>
</tr>
</tbody>
</table>


</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>poly_reg_fit <span class="sc">%&gt;%</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">extract_fit_engine</span>() <span class="sc">%&gt;%</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>()  <span class="sc">%&gt;%</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>() <span class="sc">%&gt;%</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-hover table-striped caption-top table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">term</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">estimate</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">std.error</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">statistic</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">40.3417328</td>
<td style="text-align: right;">1.4595604</td>
<td style="text-align: right;">27.6396465</td>
<td style="text-align: right;">0.0000000</td>
</tr>
<tr class="even">
<td style="text-align: left;">chas</td>
<td style="text-align: right;">4.0258219</td>
<td style="text-align: right;">1.0242060</td>
<td style="text-align: right;">3.9306758</td>
<td style="text-align: right;">0.0001010</td>
</tr>
<tr class="odd">
<td style="text-align: left;">age_poly_1</td>
<td style="text-align: right;">0.0888854</td>
<td style="text-align: right;">0.0529147</td>
<td style="text-align: right;">1.6797863</td>
<td style="text-align: right;">0.0938362</td>
</tr>
<tr class="even">
<td style="text-align: left;">age_poly_2</td>
<td style="text-align: right;">-0.0001052</td>
<td style="text-align: right;">0.0004307</td>
<td style="text-align: right;">-0.2443064</td>
<td style="text-align: right;">0.8071279</td>
</tr>
<tr class="odd">
<td style="text-align: left;">lstat_poly_1</td>
<td style="text-align: right;">-2.6872212</td>
<td style="text-align: right;">0.1444779</td>
<td style="text-align: right;">-18.5995316</td>
<td style="text-align: right;">0.0000000</td>
</tr>
<tr class="even">
<td style="text-align: left;">lstat_poly_2</td>
<td style="text-align: right;">0.0484748</td>
<td style="text-align: right;">0.0040289</td>
<td style="text-align: right;">12.0316939</td>
<td style="text-align: right;">0.0000000</td>
</tr>
</tbody>
</table>


</div>
</div>
<p>Note that the term for <code>age_poly_2</code> is not statistically significant. We’ll drop it from the model and re-run the regression.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>poly_reg_spec <span class="ot">&lt;-</span> <span class="fu">linear_reg</span>() <span class="sc">%&gt;%</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"lm"</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>poly_reg_rec <span class="ot">&lt;-</span> <span class="fu">recipe</span>(medv <span class="sc">~</span> age <span class="sc">+</span> lstat <span class="sc">+</span> chas, <span class="at">data =</span> boston_train) <span class="sc">%&gt;%</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_poly</span>(lstat, <span class="at">degree =</span> <span class="dv">2</span>, <span class="at">options =</span> <span class="fu">list</span>(<span class="at">raw =</span> <span class="cn">TRUE</span>))</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>poly_reg_wf <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(poly_reg_spec) <span class="sc">%&gt;%</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(poly_reg_rec)</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>poly_reg_fit <span class="ot">&lt;-</span> poly_reg_wf <span class="sc">%&gt;%</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(boston_train)</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>poly_reg_fit <span class="sc">%&gt;%</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glance</span>() <span class="sc">%&gt;%</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>() <span class="sc">%&gt;%</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-hover table-striped caption-top table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">r.squared</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">adj.r.squared</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">sigma</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">statistic</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">p.value</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">df</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">logLik</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">AIC</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">BIC</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">deviance</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">df.residual</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">nobs</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0.7015881</td>
<td style="text-align: right;">0.6983965</td>
<td style="text-align: right;">5.033456</td>
<td style="text-align: right;">219.8253</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">-1147.766</td>
<td style="text-align: right;">2307.531</td>
<td style="text-align: right;">2331.156</td>
<td style="text-align: right;">9475.543</td>
<td style="text-align: right;">374</td>
<td style="text-align: right;">379</td>
</tr>
</tbody>
</table>


</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>poly_reg_fit <span class="sc">%&gt;%</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">extract_fit_engine</span>() <span class="sc">%&gt;%</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>()  <span class="sc">%&gt;%</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>() <span class="sc">%&gt;%</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-hover table-striped caption-top table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">term</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">estimate</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">std.error</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">statistic</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">40.6120902</td>
<td style="text-align: right;">0.9504752</td>
<td style="text-align: right;">42.728194</td>
<td style="text-align: right;">0.00e+00</td>
</tr>
<tr class="even">
<td style="text-align: left;">age</td>
<td style="text-align: right;">0.0763219</td>
<td style="text-align: right;">0.0124520</td>
<td style="text-align: right;">6.129314</td>
<td style="text-align: right;">0.00e+00</td>
</tr>
<tr class="odd">
<td style="text-align: left;">chas</td>
<td style="text-align: right;">4.0279077</td>
<td style="text-align: right;">1.0228822</td>
<td style="text-align: right;">3.937802</td>
<td style="text-align: right;">9.81e-05</td>
</tr>
<tr class="even">
<td style="text-align: left;">lstat_poly_1</td>
<td style="text-align: right;">-2.6830521</td>
<td style="text-align: right;">0.1432861</td>
<td style="text-align: right;">-18.725144</td>
<td style="text-align: right;">0.00e+00</td>
</tr>
<tr class="odd">
<td style="text-align: left;">lstat_poly_2</td>
<td style="text-align: right;">0.0482845</td>
<td style="text-align: right;">0.0039480</td>
<td style="text-align: right;">12.230164</td>
<td style="text-align: right;">0.00e+00</td>
</tr>
</tbody>
</table>


</div>
</div>
<p>There; now all of our model terms are statistically significant. Let’s see what that model looks like!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>poly_reg_fit <span class="sc">%&gt;%</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">augment</span>(boston_train) <span class="sc">%&gt;%</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> lstat, <span class="at">y =</span> medv),</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span> </span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> lstat, <span class="at">y =</span> .pred), </span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">"red"</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> <span class="fl">0.4</span>) <span class="sc">+</span> </span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Proportion of Residents with Low Socioeconomic Status"</span>,</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Median Neighborhood Home Value (000s)"</span>,</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Median Home Values and Socioeconomic Status"</span>,</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Actuals in Black, Predicted Values in Red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="13d_HigherOrderTerms_Polynomial_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We can also look at our model for a few <code>age</code> thresholds.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>new_data <span class="ot">&lt;-</span> <span class="fu">crossing</span>(<span class="at">age =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">25</span>, <span class="dv">50</span>),</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">chas =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">lstat =</span> <span class="fu">seq</span>(<span class="fu">min</span>(boston_train<span class="sc">$</span>lstat, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">max</span>(boston_train<span class="sc">$</span>lstat, <span class="at">na.rm =</span> <span class="cn">TRUE</span>,</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">by =</span> <span class="dv">1</span>)))</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>poly_reg_fit <span class="sc">%&gt;%</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">augment</span>(new_data) <span class="sc">%&gt;%</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> lstat, </span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>                <span class="at">y =</span> .pred, </span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>                <span class="at">color =</span> <span class="fu">as.factor</span>(age),</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>                <span class="at">linetype =</span> <span class="fu">as.factor</span>(chas)),</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">lwd =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Proportion of Residents with Low Socioeconomic Status"</span>,</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Predicted Median Home Value"</span>,</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Estimated Median Home Values"</span>,</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"(by prevalence of low socioeconomic status)"</span>,</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"% Homes Built </span><span class="sc">\n</span><span class="st">Prior to 1940"</span>,</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>       <span class="at">linetype =</span> <span class="st">"On Charles River"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="13d_HigherOrderTerms_Polynomial_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>This is a model we can interpret and utilize. Before we do, including higher-order terms in a model requires some additional care.</p>
<p><strong>Note:</strong> Since <code>lstat_poly_2</code>, the term corresponding to <code>lstat</code><span class="math inline">\(^2\)</span>, is statistically significant, we must keep the lower order term for <code>lstat</code> in the model. In general, if we have a statistically significant higher-order, or interaction term in a model, then we <em>must</em> retain all of the associated lower-order terms in the model, regardless of whether or not they are statistically significant. For example, if we had a term for <code>lstat</code><span class="math inline">\(\cdot\)</span><code>age</code><span class="math inline">\(^2\)</span> in our model, then we must keep the individual terms for <code>lstat</code> and <code>age</code>, the term for <code>age</code><span class="math inline">\(^2\)</span> and the term for <code>lstat</code><span class="math inline">\(\cdot\)</span><code>age</code>, regardless of whether the <span class="math inline">\(p\)</span>-values associated with those terms are small.</p>
<section id="interpreting-a-model-with-curvature" class="level3">
<h3 class="anchored" data-anchor-id="interpreting-a-model-with-curvature">Interpreting a Model with Curvature</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>poly_reg_fit <span class="sc">%&gt;%</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">extract_fit_engine</span>() <span class="sc">%&gt;%</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>() <span class="sc">%&gt;%</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-hover table-striped caption-top table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">term</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">estimate</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">std.error</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">statistic</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">40.6120902</td>
<td style="text-align: right;">0.9504752</td>
<td style="text-align: right;">42.728194</td>
<td style="text-align: right;">0.00e+00</td>
</tr>
<tr class="even">
<td style="text-align: left;">age</td>
<td style="text-align: right;">0.0763219</td>
<td style="text-align: right;">0.0124520</td>
<td style="text-align: right;">6.129314</td>
<td style="text-align: right;">0.00e+00</td>
</tr>
<tr class="odd">
<td style="text-align: left;">chas</td>
<td style="text-align: right;">4.0279077</td>
<td style="text-align: right;">1.0228822</td>
<td style="text-align: right;">3.937802</td>
<td style="text-align: right;">9.81e-05</td>
</tr>
<tr class="even">
<td style="text-align: left;">lstat_poly_1</td>
<td style="text-align: right;">-2.6830521</td>
<td style="text-align: right;">0.1432861</td>
<td style="text-align: right;">-18.725144</td>
<td style="text-align: right;">0.00e+00</td>
</tr>
<tr class="odd">
<td style="text-align: left;">lstat_poly_2</td>
<td style="text-align: right;">0.0482845</td>
<td style="text-align: right;">0.0039480</td>
<td style="text-align: right;">12.230164</td>
<td style="text-align: right;">0.00e+00</td>
</tr>
</tbody>
</table>


</div>
</div>
<p>Now that we have estimated coefficients, we can write down the estimated model form: <span class="math display">\[\mathbb{E}\left[\text{medv}\right] \approx 40.61 + 0.08\cdot\text{age} + 4.03\cdot\text{chas} - 2.68\cdot\text{lstat} + 0.05\cdot\text{lstat}^2\]</span></p>
<p>From here, we see that older neighborhoods tend to have slightly higher median home values. Neighborhoods along the Charles River have higher median home values. Before moving to interpret the <code>lstat</code> variable, let’s formalize the interpretations associated with <code>age</code> and <code>chas</code>.</p>
<ul>
<li><p>Holding all variables other than <code>age</code> constant (controlling for them), an increase by <span class="math inline">\(1\)</span> percentage point in the proportion of homes in a neighborhood built before 1940 is associated with higher median home values by about <span class="math inline">\(\$80\)</span>, on average.</p>
<ul>
<li>Alternatively, given two otherwise similar neighborhoods (<code>lstat</code> and <code>chas</code>), the neighborhood with a larger percentage of homes built before 1940 is expected to have a higher median home value by about <span class="math inline">\(\$80\)</span> per percentage point, on average.</li>
</ul></li>
<li><p>Holding all variables other than <code>chas</code> constant (controlling for them), median home values for neighborhoods on the Charles River are expected to be about <span class="math inline">\(\$4,030\)</span> higher, on average.</p>
<ul>
<li>Alternatively, given two otherwise similar (<code>age</code> and <code>lstat</code>) neighborhoods, the one on the Charles River is expected to have approximately <span class="math inline">\(\$4,030\)</span> higher median home values, on average, than the neighborhood away from the Charles River.</li>
</ul></li>
</ul>
<p>Because the effect of <code>lstat</code> is split across multiple terms, we need some way to aggregate that effect. As a reminder, we are looking for <em>rate of change</em> in <code>medv</code> with respect to <code>lstat</code>. Those of you with a calculus background will recognize that we are interested in finding the partial derivative of our model with respect to <code>lstat</code>. For those of you without a calculus background, you’ll just use the expression below:</p>
<p><span class="math display">\[\begin{align} &amp;\text{Rate of Change in medv With Respect to lstat: }\\ &amp;~~~~\beta_{\text{lstat}} + 2\beta_{\text{lstat}^2}\cdot \text{lstat} = -2.68 + 2\left(0.05\right)\cdot\text{lstat}\end{align}\]</span></p>
<p>The rate of change in median home values (<code>medv</code>) with respect to the percentage of residents with low socioeconomic status now depends on the level of the percentage of residents with low socioeconomic status. The associated drop in median home values is large for percentage point increases from relatively low prevalence of residents with low socioeconomic status, but then for neighborhoods with already high levels of residents with low socioeconomic status, the decrease in median home values is less. For example, the difference in median home values between a neighborhood with 10% of residents having low socioeconomic status and a neighborhood with 11% of residents having low socioeconomic status is expected to be about <span class="math inline">\(-2.68 + 0.1\cdot 10\)</span>. That is, we expect lower median home values by about <span class="math inline">\(\$1,680\)</span>, on average. The difference in expected median home values between a neighborhood with 20% of residents having low socioeconomic status and a neighborhood with 21% though is expected to be about <span class="math inline">\(-2.68 + 0.1\cdot 20\)</span>, or about <span class="math inline">\(\$680\)</span> less, on average.</p>
<p>The inclusion of these polynomial terms allows us to model more complex relationships and potentially build models with better predictive value! There are a few things to beware of though – these models are more complicated to interpret and we risk tricking ourselves into believing our models are much more accurate than they will be in production (More on this later in our course).</p>
<section id="interpretation-with-marginaleffects" class="level4">
<h4 class="anchored" data-anchor-id="interpretation-with-marginaleffects">Interpretation with <code>{marginaleffects}</code></h4>
<p>As we saw in an earlier notebook, we can use the <code>{marginaleffects}</code> package to estimate the marginal effect of a unit increase in <code>lstat</code> on median home values at different levels of the <code>lstat</code> variable. We can also obtain confidence interval estimates in these effects as well.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>counterfactual_lstat_df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">lstat =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">40</span>, <span class="at">length.out =</span> <span class="dv">500</span>),</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">age =</span> <span class="dv">50</span>,</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">chas =</span> <span class="dv">1</span>)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>mfx <span class="ot">&lt;-</span> poly_reg_fit <span class="sc">%&gt;%</span> </span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slopes</span>(<span class="at">newdata =</span> counterfactual_lstat_df,</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">variables =</span> <span class="st">"lstat"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Not sure why, but slopes() is obliterating lstat values</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lstat =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">40</span>, <span class="at">length.out =</span> <span class="dv">500</span>))</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>mfx <span class="sc">%&gt;%</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(term, lstat, estimate, conf.low, conf.high, std.error) <span class="sc">%&gt;%</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="at">n =</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>() <span class="sc">%&gt;%</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-hover table-striped caption-top table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">term</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">lstat</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">estimate</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">conf.low</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">conf.high</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">std.error</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">lstat</td>
<td style="text-align: right;">0.0000000</td>
<td style="text-align: right;">-2.683052</td>
<td style="text-align: right;">-2.963899</td>
<td style="text-align: right;">-2.402205</td>
<td style="text-align: right;">0.1432920</td>
</tr>
<tr class="even">
<td style="text-align: left;">lstat</td>
<td style="text-align: right;">0.0801603</td>
<td style="text-align: right;">-2.675311</td>
<td style="text-align: right;">-2.954985</td>
<td style="text-align: right;">-2.395637</td>
<td style="text-align: right;">0.1426933</td>
</tr>
<tr class="odd">
<td style="text-align: left;">lstat</td>
<td style="text-align: right;">0.1603206</td>
<td style="text-align: right;">-2.667570</td>
<td style="text-align: right;">-2.946058</td>
<td style="text-align: right;">-2.389082</td>
<td style="text-align: right;">0.1420885</td>
</tr>
<tr class="even">
<td style="text-align: left;">lstat</td>
<td style="text-align: right;">0.2404810</td>
<td style="text-align: right;">-2.659829</td>
<td style="text-align: right;">-2.937145</td>
<td style="text-align: right;">-2.382513</td>
<td style="text-align: right;">0.1414904</td>
</tr>
<tr class="odd">
<td style="text-align: left;">lstat</td>
<td style="text-align: right;">0.3206413</td>
<td style="text-align: right;">-2.652088</td>
<td style="text-align: right;">-2.928220</td>
<td style="text-align: right;">-2.375956</td>
<td style="text-align: right;">0.1408862</td>
</tr>
<tr class="even">
<td style="text-align: left;">lstat</td>
<td style="text-align: right;">0.4008016</td>
<td style="text-align: right;">-2.644347</td>
<td style="text-align: right;">-2.919320</td>
<td style="text-align: right;">-2.369374</td>
<td style="text-align: right;">0.1402951</td>
</tr>
<tr class="odd">
<td style="text-align: left;">lstat</td>
<td style="text-align: right;">0.4809619</td>
<td style="text-align: right;">-2.636606</td>
<td style="text-align: right;">-2.910427</td>
<td style="text-align: right;">-2.362785</td>
<td style="text-align: right;">0.1397071</td>
</tr>
<tr class="even">
<td style="text-align: left;">lstat</td>
<td style="text-align: right;">0.5611222</td>
<td style="text-align: right;">-2.628865</td>
<td style="text-align: right;">-2.901498</td>
<td style="text-align: right;">-2.356232</td>
<td style="text-align: right;">0.1391011</td>
</tr>
<tr class="odd">
<td style="text-align: left;">lstat</td>
<td style="text-align: right;">0.6412826</td>
<td style="text-align: right;">-2.621124</td>
<td style="text-align: right;">-2.892588</td>
<td style="text-align: right;">-2.349660</td>
<td style="text-align: right;">0.1385046</td>
</tr>
<tr class="even">
<td style="text-align: left;">lstat</td>
<td style="text-align: right;">0.7214429</td>
<td style="text-align: right;">-2.613383</td>
<td style="text-align: right;">-2.883666</td>
<td style="text-align: right;">-2.343100</td>
<td style="text-align: right;">0.1379020</td>
</tr>
</tbody>
</table>


</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>mfx <span class="sc">%&gt;%</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(lstat, estimate, conf.low, conf.high) <span class="sc">%&gt;%</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lstat =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">40</span>, <span class="at">length.out =</span> <span class="dv">500</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> lstat, <span class="at">y =</span> estimate), </span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">"purple"</span>, <span class="at">lty =</span> <span class="st">"dashed"</span>, <span class="at">lwd =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">x =</span> lstat, <span class="at">ymin =</span> conf.low, <span class="at">ymax =</span> conf.high),</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill =</span> <span class="st">"grey"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Pct Low Socioeconomic Status"</span>,</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Marginal Effect"</span>,</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Marginal Effects of Unit Increase in lstat"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="13d_HigherOrderTerms_Polynomial_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>As we can see from the plot above, the marginal effect of a unit increase in the percentage of residents with low socioeconomic status is expected to be a decrease in median home values up until low socioeconomic status residents make up about 27% of the neighborhood population. After this point, we expect the marginal effect to be an increase in median home values. We see this also from our earlier plot of estimated median home values by prevalence of low socioeconomic status, plotted at different thresholds of the <code>age</code> and <code>chas</code> variables.</p>
</section>
</section>
<section id="assessing-model-performance" class="level3">
<h3 class="anchored" data-anchor-id="assessing-model-performance">Assessing Model Performance</h3>
<p>Before we move on, let’s assess the performance of our new model. As a reminder, we had the following benchmarks from the <em>main effects</em> model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>my_metrics <span class="ot">&lt;-</span> <span class="fu">metric_set</span>(rsq, rmse)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>(main_reg_fit <span class="sc">%&gt;%</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">augment</span>(boston_train) <span class="sc">%&gt;%</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">my_metrics</span>(medv, .pred) <span class="sc">%&gt;%</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">type =</span> <span class="st">"train"</span>)</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>    main_reg_fit <span class="sc">%&gt;%</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">augment</span>(boston_test) <span class="sc">%&gt;%</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">my_metrics</span>(medv, .pred) <span class="sc">%&gt;%</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">type =</span> <span class="st">"test"</span>)</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> .metric,</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>              <span class="at">names_from =</span> type,</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>              <span class="at">values_from =</span> .estimate) <span class="sc">%&gt;%</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>() <span class="sc">%&gt;%</span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-striped table-hover caption-top table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">.metric</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">train</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">test</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">rsq</td>
<td style="text-align: right;">0.5822417</td>
<td style="text-align: right;">0.5235821</td>
</tr>
<tr class="even">
<td style="text-align: left;">rmse</td>
<td style="text-align: right;">5.9161187</td>
<td style="text-align: right;">6.4395620</td>
</tr>
</tbody>
</table>


</div>
</div>
<p>We can compute the same metrics for our new model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>(poly_reg_fit <span class="sc">%&gt;%</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">augment</span>(boston_train) <span class="sc">%&gt;%</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">my_metrics</span>(medv, .pred) <span class="sc">%&gt;%</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">type =</span> <span class="st">"train"</span>)</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    poly_reg_fit <span class="sc">%&gt;%</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">augment</span>(boston_test) <span class="sc">%&gt;%</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">my_metrics</span>(medv, .pred) <span class="sc">%&gt;%</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">type =</span> <span class="st">"test"</span>)</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> .metric,</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>              <span class="at">names_from =</span> type,</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>              <span class="at">values_from =</span> .estimate) <span class="sc">%&gt;%</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>() <span class="sc">%&gt;%</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-striped table-hover caption-top table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">.metric</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">train</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">test</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">rsq</td>
<td style="text-align: right;">0.7015881</td>
<td style="text-align: right;">0.6200447</td>
</tr>
<tr class="even">
<td style="text-align: left;">rmse</td>
<td style="text-align: right;">5.0001432</td>
<td style="text-align: right;">5.8125488</td>
</tr>
</tbody>
</table>


</div>
</div>
<p>We are doing quite a bit better now! The R-Squared value for our new model on the training data is up to 70% (from 58% with the main effects model). We’ve also observed an improvement in R-Squared on the test data – 62% versus 52%. Much more of the variation in median home values is being explained by our curvi-linear model than was explained with our main effects model. Similarly, we’ve observed improvements in the RMSE (<em>root mean squared error</em>). The test RMSE for our main effects model was approximately <span class="math inline">\(6.4\)</span>, indicating that we could expect our predictions to be accurate to within about <span class="math inline">\(\$12,800\)</span> on average. The test RMSE for our curvi-linear model is approximately 5.8, indicating that we should expect our predictions to be accurate to within about <span class="math inline">\(\$11,600\)</span> on average.</p>
<hr>
</section>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>Okay, let’s recap. We worked with a new data set today – the <code>boston</code> housing data set. For this particular application, we were interested in predicting median home values (<code>medv</code>) for neighborhoods in 1970’s Boston, given</p>
<ul>
<li><code>age</code> – the proportion of homes in the neighborhood built prior to <span class="math inline">\(1940\)</span>.</li>
<li><code>lstat</code> – the proportion of neighborhood residents having low socioeconomic status.</li>
<li><code>chas</code> – an indicator (dummy) variable for whether the neighborhood is along the Charles River or not.</li>
</ul>
<p>In our initial exploratory analysis, we saw visual evidence that the association between <code>medv</code> and <code>lstat</code> was not a <em>straight-line</em> association. We suspected that a model allowing for a curved relationship between <code>lstat</code> and <code>medv</code> would outperform a model that assumed a straight-line relationship. We went ahead and built a model assuming straight line relationships between <code>medv</code> and both <code>age</code> and <code>lstat</code>, but which also accounted for the location of the neighborhood being on the Charles River or away from the Charles River. The terms in that model were statistically significant, so we obtained some performance metrics for this model and used those as a <em>benchmark</em>.</p>
<p>We then built a model allowing for curved relationships between <code>medv</code> and both <code>age</code> and <code>lstat</code>. There wasn’t statistically significant evidence to keep the curvature between <code>medv</code> and <code>age</code>, so we dropped it and returned to a linear relationship between <code>medv</code> and <code>age</code>. There was, however, statistically significant evidence for a curved relationship between <code>medv</code> and <code>lstat</code>. We interpreted our new model and calculated performance metrics for it, noting that the model allowing for curvature out-performed our original model on the unseen test data.</p>
<p>In the next notebook, we’ll return to the <code>penguins</code> data and see what interaction terms allow for in a model.</p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>